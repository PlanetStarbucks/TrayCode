/**
 * Script use to parse the Workfront document metadata into an array for uploading assets to Bynder.
 *
 * @param {Object} input - contains the following properties from the workflow:
 * @param {Array} input.workfront_documents - collection of Workfront document metadata with a Workfront task that has been created/changed since the last sync
 * @param {string} input.old_last_update - timestamp of the last sync from storage
 * @param {string} input.wf_sub_domain - Workfront's subdomain from auth connection, used to format the URLs back to Workfront
 * @param {Object} input.config - contains the following:
 * @param {number} input.config.workfront_paging_limit - not used by this script
 * @param {string} input.config.initial_last_update - not used by this script
 * @param {string} input.config.bynder_brand_id - not used by this script
 * @param {string} input.config.workfront_task_status - not used by this script
 * @param {string} input.config.bynder_meta_id_workfront_doc_url - Bynder's metaproperty ID that is used to map the Workfront document URL
 * @param {string} input.config.bynder_meta_id_workfront_task_url - Bynder's metaproperty ID that is used to map the Workfront task URL
 * @param {string} input.config.bynder_meta_id_workfront_version_id - Bynder's metaproperty ID that is used to map the Workfront version ID
 * @param {string} input.config.bynder_meta_id_workfront_doc_id - Bynder's metaproperty ID that is used to map the Workfront document ID
 * @param {Array} input.config.meta_mappings - collection of mapping configurations between Workfront metadata and Bynder metaproperties
 *
 * @param {*} fileInput - not used
 *
 * @returns {Object} - contains the following:
 *  - {Array} wf_to_bynder - collection of Workfront metadata that needs to be sent to Bynder assets
 *  - {string} new_last_update - most recent timestamp from the current data, will be set in storage after the loop
 */
var _ = require("lodash");

const input = {
	workfront_documents: [
		{
			ID: "63dbf1ab000de807924eb10b51ff239d",
			name: "8sjBzL1IyMo",
			objCode: "DOCU",
			categoryID: null,
			checkOutTimestamp: null,
			checkedOutByID: null,
			currentVersionID: "63dc2448001d89b98f3b73a581a84b7c",
			customerID: "5807c55400789d2ba24b3cbac3674e09",
			description: null,
			docObjCode: "TASK",
			documentRequestID: null,
			extRefID: null,
			hasNotes: false,
			isPrivate: false,
			isPublic: false,
			iterationID: null,
			lastModDate: "2023-02-02T14:59:52:570-0600",
			lastNoteID: null,
			lastSyncDate: null,
			lastUpdateDate: "2023-02-02T14:59:52:577-0600",
			lastUpdatedByID: "61e1a70f000cedae620ff5e2114158d4",
			lastVersionNum: "2",
			objID: "63dbf170000dccc64c76676545f44534",
			opTaskID: null,
			ownerID: "61e1a70f000cedae620ff5e2114158d4",
			portfolioID: null,
			programID: null,
			projectID: "63348b0f004b04f58424a201fd0a1ab1",
			publicToken: null,
			referenceNumber: 13911,
			releaseVersionID: null,
			securityRootID: "63348b0f004b04f58424a201fd0a1ab1",
			securityRootObjCode: "PROJ",
			taskID: "63dbf170000dccc64c76676545f44534",
			templateID: null,
			templateTaskID: null,
			topDocObjCode: "PROJ",
			topObjID: "63348b0f004b04f58424a201fd0a1ab1",
			userID: null,
			downloadURL: "/internal/document/download?ID=63dbf1ab000de807924eb10b51ff239d",
			parameterValues: {},
			versions: [
				{
					ID: "63dbf1ab000de808ab4d5ab736a6a989",
					objCode: "DOCV",
					ext: "jpg",
					fileName: "1_63dbf1ab000de807924eb10b51ff239d_patrick-federi-bvC1ExlcYtk-unsplash",
					externalIntegrationType: "ATTASK",
					version: "1",
					fileType: "file",
				},
				{
					ID: "63dc2448001d89b98f3b73a581a84b7c",
					objCode: "DOCV",
					ext: "jpg",
					fileName: "2_63dbf1ab000de807924eb10b51ff239d_8sjBzL1IyMo",
					externalIntegrationType: "ATTASK",
					version: "2",
					fileType: "file",
				},
			],
			task: {
				ID: "63dbf170000dccc64c76676545f44534",
				name: "Bynder Test 2",
				objCode: "TASK",
				URL: null,
				actualCompletionDate: "2023-02-08T14:19:41:640-0600",
				actualCost: 0,
				actualDuration: 0,
				actualDurationMinutes: 0,
				actualExpenseCost: 0,
				actualLaborCost: 0,
				actualRevenue: 0,
				actualStartDate: "2023-02-02T11:29:55:734-0600",
				actualWork: 0,
				actualWorkRequired: 0,
				approvalCompletionDate: null,
				approvalEstStartDate: null,
				approvalPlannedStartDate: null,
				approvalProcessID: null,
				approvalProjectedStartDate: null,
				approvalStartDate: null,
				assignedToID: "61e1a70f000cedae620ff5e2114158d4",
				auditTypes: [],
				backlogOrder: 0,
				billingAmount: 0,
				billingRecordID: null,
				canStart: true,
				categoryID: null,
				color: null,
				commitDate: null,
				completionPendingDate: null,
				condition: 0,
				constraintDate: null,
				convertedOpTaskEntryDate: null,
				convertedOpTaskName: null,
				convertedOpTaskOriginatorID: null,
				costAmount: 0,
				costType: "UHR",
				cpi: 0,
				csi: 0,
				currentApprovalStepID: null,
				customerID: "5807c55400789d2ba24b3cbac3674e09",
				description: "WAHTCHA GONNA DO?!",
				duration: 0,
				durationMinutes: 0,
				durationType: "W",
				durationUnit: "D",
				eac: 0,
				enteredByID: "61e1a70f000cedae620ff5e2114158d4",
				entryDate: "2023-02-02T11:22:56:603-0600",
				estCompletionDate: null,
				estStartDate: null,
				extRefID: null,
				groupID: "5807c55c0078a14930bfdb01b44e37fa",
				handoffDate: null,
				hasCompletionConstraint: false,
				hasDocuments: true,
				hasExpenses: false,
				hasMessages: false,
				hasNotes: false,
				hasResolvables: false,
				hasStartConstraint: false,
				hasTimedNotifications: false,
				hoursPerPoint: 0,
				indent: 0,
				isAgile: false,
				isCritical: false,
				isDurationLocked: false,
				isLevelingExcluded: false,
				isReady: false,
				isStatusComplete: true,
				isWorkRequiredLocked: false,
				iterationID: null,
				kanbanBoardID: null,
				kanbanFlag: null,
				lastConditionNoteID: null,
				lastNoteID: null,
				lastUpdateDate: "2023-02-08T14:45:20:366-0600",
				lastUpdatedByID: "61e1a70f000cedae620ff5e2114158d4",
				levelingStartDelay: 0,
				levelingStartDelayMinutes: 0,
				milestoneID: null,
				numberOfChildren: 0,
				numberOpenOpTasks: 0,
				originalDuration: 0,
				originalWorkRequired: 0,
				parentID: null,
				parentLag: 0,
				parentLagType: "d",
				pendingCalculation: null,
				pendingUpdateMethods: [],
				percentComplete: 100,
				personal: true,
				plannedCompletionDate: null,
				plannedCost: 0,
				plannedDuration: 0,
				plannedDurationMinutes: 0,
				plannedExpenseCost: 0,
				plannedLaborCost: 0,
				plannedRevenue: 0,
				plannedStartDate: "2023-02-02T11:22:56:614-0600",
				previousStatus: "XXU",
				priority: 2,
				progressStatus: "ON",
				projectID: "63348b0f004b04f58424a201fd0a1ab1",
				projectedCompletionDate: null,
				projectedDurationMinutes: null,
				projectedStartDate: null,
				recurrenceNumber: 0,
				recurrenceRuleID: null,
				referenceNumber: 13910,
				rejectionIssueID: null,
				remainingDurationMinutes: 0,
				resourceScope: "NONE",
				revenueType: "FRV",
				roleID: null,
				securityRootID: "63348b0f004b04f58424a201fd0a1ab1",
				securityRootObjCode: "PROJ",
				slackDate: null,
				spi: 0,
				status: "CPL",
				statusUpdate: null,
				submittedByID: null,
				taskConstraint: "ASAP",
				taskNumber: 0,
				teamID: null,
				templateTaskID: null,
				trackingMode: "USER",
				version: 0,
				wbs: "",
				work: 0,
				workRequired: 0,
				parameterValues: {},
				reservedTimeID: null,
				reservedTime: null,
			},
		},
		{
			ID: "63dbf1ad000de8e4ddddb91787355e57",
			name: "omar-sotillo-franco-fzazNcCgTrM-unsplash",
			objCode: "DOCU",
			categoryID: null,
			checkOutTimestamp: null,
			checkedOutByID: null,
			currentVersionID: "63dbf1ad000de8e57409b3f231936874",
			customerID: "5807c55400789d2ba24b3cbac3674e09",
			description: null,
			docObjCode: "TASK",
			documentRequestID: null,
			extRefID: null,
			hasNotes: false,
			isPrivate: false,
			isPublic: false,
			iterationID: null,
			lastModDate: "2023-02-02T11:23:57:932-0600",
			lastNoteID: null,
			lastSyncDate: null,
			lastUpdateDate: "2023-02-02T11:23:57:944-0600",
			lastUpdatedByID: "61e1a70f000cedae620ff5e2114158d4",
			lastVersionNum: "1",
			objID: "63dbf170000dccc64c76676545f44534",
			opTaskID: null,
			ownerID: "61e1a70f000cedae620ff5e2114158d4",
			portfolioID: null,
			programID: null,
			projectID: "63348b0f004b04f58424a201fd0a1ab1",
			publicToken: null,
			referenceNumber: 13912,
			releaseVersionID: null,
			securityRootID: "63348b0f004b04f58424a201fd0a1ab1",
			securityRootObjCode: "PROJ",
			taskID: "63dbf170000dccc64c76676545f44534",
			templateID: null,
			templateTaskID: null,
			topDocObjCode: "PROJ",
			topObjID: "63348b0f004b04f58424a201fd0a1ab1",
			userID: null,
			downloadURL: "/internal/document/download?ID=63dbf1ad000de8e4ddddb91787355e57",
			parameterValues: {},
			versions: [
				{
					ID: "63dbf1ad000de8e57409b3f231936874",
					objCode: "DOCV",
					ext: "jpg",
					fileName: "1_63dbf1ad000de8e4ddddb91787355e57_omar-sotillo-franco-fzazNcCgTrM-unsplash",
					externalIntegrationType: "ATTASK",
					version: "1",
					fileType: "file",
				},
			],
			task: {
				ID: "63dbf170000dccc64c76676545f44534",
				name: "Bynder Test 2",
				objCode: "TASK",
				URL: null,
				actualCompletionDate: "2023-02-08T14:19:41:640-0600",
				actualCost: 0,
				actualDuration: 0,
				actualDurationMinutes: 0,
				actualExpenseCost: 0,
				actualLaborCost: 0,
				actualRevenue: 0,
				actualStartDate: "2023-02-02T11:29:55:734-0600",
				actualWork: 0,
				actualWorkRequired: 0,
				approvalCompletionDate: null,
				approvalEstStartDate: null,
				approvalPlannedStartDate: null,
				approvalProcessID: null,
				approvalProjectedStartDate: null,
				approvalStartDate: null,
				assignedToID: "61e1a70f000cedae620ff5e2114158d4",
				auditTypes: [],
				backlogOrder: 0,
				billingAmount: 0,
				billingRecordID: null,
				canStart: true,
				categoryID: null,
				color: null,
				commitDate: null,
				completionPendingDate: null,
				condition: 0,
				constraintDate: null,
				convertedOpTaskEntryDate: null,
				convertedOpTaskName: null,
				convertedOpTaskOriginatorID: null,
				costAmount: 0,
				costType: "UHR",
				cpi: 0,
				csi: 0,
				currentApprovalStepID: null,
				customerID: "5807c55400789d2ba24b3cbac3674e09",
				description: "WAHTCHA GONNA DO?!",
				duration: 0,
				durationMinutes: 0,
				durationType: "W",
				durationUnit: "D",
				eac: 0,
				enteredByID: "61e1a70f000cedae620ff5e2114158d4",
				entryDate: "2023-02-02T11:22:56:603-0600",
				estCompletionDate: null,
				estStartDate: null,
				extRefID: null,
				groupID: "5807c55c0078a14930bfdb01b44e37fa",
				handoffDate: null,
				hasCompletionConstraint: false,
				hasDocuments: true,
				hasExpenses: false,
				hasMessages: false,
				hasNotes: false,
				hasResolvables: false,
				hasStartConstraint: false,
				hasTimedNotifications: false,
				hoursPerPoint: 0,
				indent: 0,
				isAgile: false,
				isCritical: false,
				isDurationLocked: false,
				isLevelingExcluded: false,
				isReady: false,
				isStatusComplete: true,
				isWorkRequiredLocked: false,
				iterationID: null,
				kanbanBoardID: null,
				kanbanFlag: null,
				lastConditionNoteID: null,
				lastNoteID: null,
				lastUpdateDate: "2023-02-08T14:45:20:366-0600",
				lastUpdatedByID: "61e1a70f000cedae620ff5e2114158d4",
				levelingStartDelay: 0,
				levelingStartDelayMinutes: 0,
				milestoneID: null,
				numberOfChildren: 0,
				numberOpenOpTasks: 0,
				originalDuration: 0,
				originalWorkRequired: 0,
				parentID: null,
				parentLag: 0,
				parentLagType: "d",
				pendingCalculation: null,
				pendingUpdateMethods: [],
				percentComplete: 100,
				personal: true,
				plannedCompletionDate: null,
				plannedCost: 0,
				plannedDuration: 0,
				plannedDurationMinutes: 0,
				plannedExpenseCost: 0,
				plannedLaborCost: 0,
				plannedRevenue: 0,
				plannedStartDate: "2023-02-02T11:22:56:614-0600",
				previousStatus: "XXU",
				priority: 2,
				progressStatus: "ON",
				projectID: "63348b0f004b04f58424a201fd0a1ab1",
				projectedCompletionDate: null,
				projectedDurationMinutes: null,
				projectedStartDate: null,
				recurrenceNumber: 0,
				recurrenceRuleID: null,
				referenceNumber: 13910,
				rejectionIssueID: null,
				remainingDurationMinutes: 0,
				resourceScope: "NONE",
				revenueType: "FRV",
				roleID: null,
				securityRootID: "63348b0f004b04f58424a201fd0a1ab1",
				securityRootObjCode: "PROJ",
				slackDate: null,
				spi: 0,
				status: "CPL",
				statusUpdate: null,
				submittedByID: null,
				taskConstraint: "ASAP",
				taskNumber: 0,
				teamID: null,
				templateTaskID: null,
				trackingMode: "USER",
				version: 0,
				wbs: "",
				work: 0,
				workRequired: 0,
				parameterValues: {},
				reservedTimeID: null,
				reservedTime: null,
			},
		},
		{
			ID: "63e403ae0018a6b7e1231e2845ea6cd1",
			name: "U9U7wvIm0gY",
			objCode: "DOCU",
			categoryID: null,
			checkOutTimestamp: null,
			checkedOutByID: null,
			currentVersionID: "63e403ae0018a6b851a5165ad4a397b2",
			customerID: "5807c55400789d2ba24b3cbac3674e09",
			description: null,
			docObjCode: "TASK",
			documentRequestID: null,
			extRefID: null,
			hasNotes: false,
			isPrivate: false,
			isPublic: false,
			iterationID: null,
			lastModDate: "2023-02-08T14:18:54:100-0600",
			lastNoteID: null,
			lastSyncDate: null,
			lastUpdateDate: "2023-02-08T14:18:54:106-0600",
			lastUpdatedByID: "61e1a70f000cedae620ff5e2114158d4",
			lastVersionNum: "1",
			objID: "63dbf170000dccc64c76676545f44534",
			opTaskID: null,
			ownerID: "61e1a70f000cedae620ff5e2114158d4",
			portfolioID: null,
			programID: null,
			projectID: "63348b0f004b04f58424a201fd0a1ab1",
			publicToken: null,
			referenceNumber: 13950,
			releaseVersionID: null,
			securityRootID: "63348b0f004b04f58424a201fd0a1ab1",
			securityRootObjCode: "PROJ",
			taskID: "63dbf170000dccc64c76676545f44534",
			templateID: null,
			templateTaskID: null,
			topDocObjCode: "PROJ",
			topObjID: "63348b0f004b04f58424a201fd0a1ab1",
			userID: null,
			downloadURL: "/internal/document/download?ID=63e403ae0018a6b7e1231e2845ea6cd1",
			parameterValues: {},
			versions: [
				{
					ID: "63e403ae0018a6b851a5165ad4a397b2",
					objCode: "DOCV",
					ext: "jpg",
					fileName: "1_63e403ae0018a6b7e1231e2845ea6cd1_U9U7wvIm0gY",
					externalIntegrationType: "ATTASK",
					version: "1",
					fileType: "file",
				},
			],
			task: {
				ID: "63dbf170000dccc64c76676545f44534",
				name: "Bynder Test 2",
				objCode: "TASK",
				URL: null,
				actualCompletionDate: "2023-02-08T14:19:41:640-0600",
				actualCost: 0,
				actualDuration: 0,
				actualDurationMinutes: 0,
				actualExpenseCost: 0,
				actualLaborCost: 0,
				actualRevenue: 0,
				actualStartDate: "2023-02-02T11:29:55:734-0600",
				actualWork: 0,
				actualWorkRequired: 0,
				approvalCompletionDate: null,
				approvalEstStartDate: null,
				approvalPlannedStartDate: null,
				approvalProcessID: null,
				approvalProjectedStartDate: null,
				approvalStartDate: null,
				assignedToID: "61e1a70f000cedae620ff5e2114158d4",
				auditTypes: [],
				backlogOrder: 0,
				billingAmount: 0,
				billingRecordID: null,
				canStart: true,
				categoryID: null,
				color: null,
				commitDate: null,
				completionPendingDate: null,
				condition: 0,
				constraintDate: null,
				convertedOpTaskEntryDate: null,
				convertedOpTaskName: null,
				convertedOpTaskOriginatorID: null,
				costAmount: 0,
				costType: "UHR",
				cpi: 0,
				csi: 0,
				currentApprovalStepID: null,
				customerID: "5807c55400789d2ba24b3cbac3674e09",
				description: "WAHTCHA GONNA DO?!",
				duration: 0,
				durationMinutes: 0,
				durationType: "W",
				durationUnit: "D",
				eac: 0,
				enteredByID: "61e1a70f000cedae620ff5e2114158d4",
				entryDate: "2023-02-02T11:22:56:603-0600",
				estCompletionDate: null,
				estStartDate: null,
				extRefID: null,
				groupID: "5807c55c0078a14930bfdb01b44e37fa",
				handoffDate: null,
				hasCompletionConstraint: false,
				hasDocuments: true,
				hasExpenses: false,
				hasMessages: false,
				hasNotes: false,
				hasResolvables: false,
				hasStartConstraint: false,
				hasTimedNotifications: false,
				hoursPerPoint: 0,
				indent: 0,
				isAgile: false,
				isCritical: false,
				isDurationLocked: false,
				isLevelingExcluded: false,
				isReady: false,
				isStatusComplete: true,
				isWorkRequiredLocked: false,
				iterationID: null,
				kanbanBoardID: null,
				kanbanFlag: null,
				lastConditionNoteID: null,
				lastNoteID: null,
				lastUpdateDate: "2023-02-08T14:45:20:366-0600",
				lastUpdatedByID: "61e1a70f000cedae620ff5e2114158d4",
				levelingStartDelay: 0,
				levelingStartDelayMinutes: 0,
				milestoneID: null,
				numberOfChildren: 0,
				numberOpenOpTasks: 0,
				originalDuration: 0,
				originalWorkRequired: 0,
				parentID: null,
				parentLag: 0,
				parentLagType: "d",
				pendingCalculation: null,
				pendingUpdateMethods: [],
				percentComplete: 100,
				personal: true,
				plannedCompletionDate: null,
				plannedCost: 0,
				plannedDuration: 0,
				plannedDurationMinutes: 0,
				plannedExpenseCost: 0,
				plannedLaborCost: 0,
				plannedRevenue: 0,
				plannedStartDate: "2023-02-02T11:22:56:614-0600",
				previousStatus: "XXU",
				priority: 2,
				progressStatus: "ON",
				projectID: "63348b0f004b04f58424a201fd0a1ab1",
				projectedCompletionDate: null,
				projectedDurationMinutes: null,
				projectedStartDate: null,
				recurrenceNumber: 0,
				recurrenceRuleID: null,
				referenceNumber: 13910,
				rejectionIssueID: null,
				remainingDurationMinutes: 0,
				resourceScope: "NONE",
				revenueType: "FRV",
				roleID: null,
				securityRootID: "63348b0f004b04f58424a201fd0a1ab1",
				securityRootObjCode: "PROJ",
				slackDate: null,
				spi: 0,
				status: "CPL",
				statusUpdate: null,
				submittedByID: null,
				taskConstraint: "ASAP",
				taskNumber: 0,
				teamID: null,
				templateTaskID: null,
				trackingMode: "USER",
				version: 0,
				wbs: "",
				work: 0,
				workRequired: 0,
				parameterValues: {},
				reservedTimeID: null,
				reservedTime: null,
			},
		},
		{
			ID: "63dbef69000d0affc2cea269bc12704a",
			name: "OjYD2ADfhjU",
			objCode: "DOCU",
			categoryID: null,
			checkOutTimestamp: null,
			checkedOutByID: null,
			currentVersionID: "63dbef69000d0b003c02d50e1058e5ac",
			customerID: "5807c55400789d2ba24b3cbac3674e09",
			description: null,
			docObjCode: "TASK",
			documentRequestID: null,
			extRefID: null,
			hasNotes: false,
			isPrivate: false,
			isPublic: false,
			iterationID: null,
			lastModDate: "2023-02-02T11:14:17:346-0600",
			lastNoteID: null,
			lastSyncDate: null,
			lastUpdateDate: "2023-02-02T11:14:17:354-0600",
			lastUpdatedByID: "61e1a70f000cedae620ff5e2114158d4",
			lastVersionNum: "1",
			objID: "63dbef2c000cf9d0a9505a40a6c7245b",
			opTaskID: null,
			ownerID: "61e1a70f000cedae620ff5e2114158d4",
			portfolioID: null,
			programID: null,
			projectID: "63dbef2c000cf9c44e5478ad4eb45e4e",
			publicToken: null,
			referenceNumber: 13909,
			releaseVersionID: null,
			securityRootID: "63dbef2c000cf9d0a9505a40a6c7245b",
			securityRootObjCode: "TASK",
			taskID: "63dbef2c000cf9d0a9505a40a6c7245b",
			templateID: null,
			templateTaskID: null,
			topDocObjCode: "PROJ",
			topObjID: "63dbef2c000cf9c44e5478ad4eb45e4e",
			userID: null,
			downloadURL: "/internal/document/download?ID=63dbef69000d0affc2cea269bc12704a",
			parameterValues: {},
			versions: [
				{
					ID: "63dbef69000d0b003c02d50e1058e5ac",
					objCode: "DOCV",
					ext: "jpg",
					fileName: "1_63dbef69000d0affc2cea269bc12704a_OjYD2ADfhjU",
					externalIntegrationType: "ATTASK",
					version: "1",
					fileType: "file",
				},
			],
			task: {
				ID: "63dbef2c000cf9d0a9505a40a6c7245b",
				name: "Do this thing",
				objCode: "TASK",
				URL: "",
				actualCompletionDate: "2023-02-02T11:14:24:520-0600",
				actualCost: 0,
				actualDuration: 0,
				actualDurationMinutes: 0,
				actualExpenseCost: 0,
				actualLaborCost: 0,
				actualRevenue: 0,
				actualStartDate: "2023-02-02T11:14:24:520-0600",
				actualWork: 0,
				actualWorkRequired: 0,
				approvalCompletionDate: null,
				approvalEstStartDate: null,
				approvalPlannedStartDate: null,
				approvalProcessID: null,
				approvalProjectedStartDate: null,
				approvalStartDate: null,
				assignedToID: null,
				auditTypes: [],
				backlogOrder: 7,
				billingAmount: 0,
				billingRecordID: null,
				canStart: true,
				categoryID: "5f2c0bc4001be2d2dce81afbbcf7e68e",
				color: null,
				commitDate: null,
				completionPendingDate: null,
				condition: null,
				constraintDate: null,
				convertedOpTaskEntryDate: null,
				convertedOpTaskName: null,
				convertedOpTaskOriginatorID: null,
				costAmount: 0,
				costType: "UHR",
				cpi: 1,
				csi: 1,
				currentApprovalStepID: null,
				customerID: "5807c55400789d2ba24b3cbac3674e09",
				description: "",
				duration: 16,
				durationMinutes: 7680,
				durationType: "S",
				durationUnit: "D",
				eac: 128,
				enteredByID: "61e1a70f000cedae620ff5e2114158d4",
				entryDate: "2023-02-02T11:13:16:706-0600",
				estCompletionDate: "2023-02-02T11:14:24:520-0600",
				estStartDate: "2023-02-02T11:14:24:520-0600",
				extRefID: null,
				groupID: "5807c55c0078a14930bfdb01b44e37fa",
				handoffDate: null,
				hasCompletionConstraint: false,
				hasDocuments: true,
				hasExpenses: false,
				hasMessages: false,
				hasNotes: false,
				hasResolvables: false,
				hasStartConstraint: false,
				hasTimedNotifications: false,
				hoursPerPoint: 0.5,
				indent: 0,
				isAgile: true,
				isCritical: false,
				isDurationLocked: true,
				isLevelingExcluded: false,
				isReady: false,
				isStatusComplete: true,
				isWorkRequiredLocked: true,
				iterationID: null,
				kanbanBoardID: null,
				kanbanFlag: null,
				lastConditionNoteID: null,
				lastNoteID: null,
				lastUpdateDate: "2023-04-04T10:32:38:928-0500",
				lastUpdatedByID: "61e1a70f000cedae620ff5e2114158d4",
				levelingStartDelay: 0,
				levelingStartDelayMinutes: 0,
				milestoneID: null,
				numberOfChildren: 0,
				numberOpenOpTasks: 0,
				originalDuration: 0,
				originalWorkRequired: 0,
				parentID: null,
				parentLag: 0,
				parentLagType: "d",
				pendingCalculation: null,
				pendingUpdateMethods: [],
				percentComplete: 100,
				personal: false,
				plannedCompletionDate: "2023-02-23T17:00:00:000-0600",
				plannedCost: 0,
				plannedDuration: 16,
				plannedDurationMinutes: 7680,
				plannedExpenseCost: 0,
				plannedLaborCost: 0,
				plannedRevenue: 0,
				plannedStartDate: "2023-02-02T09:00:00:000-0600",
				previousStatus: "NEW",
				priority: 2,
				progressStatus: "ON",
				projectID: "63dbef2c000cf9c44e5478ad4eb45e4e",
				projectedCompletionDate: "2023-02-02T11:14:24:520-0600",
				projectedDurationMinutes: 0,
				projectedStartDate: "2023-02-02T11:14:24:520-0600",
				recurrenceNumber: null,
				recurrenceRuleID: null,
				referenceNumber: 13904,
				rejectionIssueID: null,
				remainingDurationMinutes: 0,
				resourceScope: "NONE",
				revenueType: "FRV",
				roleID: null,
				securityRootID: "63dbef2c000cf9d0a9505a40a6c7245b",
				securityRootObjCode: "TASK",
				slackDate: "2023-04-04",
				spi: 1,
				status: "CPL",
				statusUpdate: null,
				submittedByID: null,
				taskConstraint: "ASAP",
				taskNumber: 1,
				teamID: "606b5372008a1cdc5db5bc9b7f917a6e",
				templateTaskID: "606b573f008e15d2f8e063bba418c5e8",
				trackingMode: "USER",
				version: 0,
				wbs: "1",
				work: 128,
				workRequired: 7680,
				parameterValues: {},
				reservedTimeID: null,
				reservedTime: null,
			},
		},
		{
			ID: "63bdb0a900075767602bb85c52fa5f1d",
			name: "version_bump",
			objCode: "DOCU",
			categoryID: "63bdb96a00088fa2486142418c899998",
			checkOutTimestamp: null,
			checkedOutByID: null,
			currentVersionID: "63d9af20002d242dca7c2bc70d9e16c4",
			customerID: "5807c55400789d2ba24b3cbac3674e09",
			description: null,
			docObjCode: "TASK",
			documentRequestID: null,
			extRefID: null,
			hasNotes: false,
			isPrivate: false,
			isPublic: false,
			iterationID: null,
			lastModDate: "2023-01-31T18:15:28:803-0600",
			lastNoteID: null,
			lastSyncDate: null,
			lastUpdateDate: "2023-01-31T18:15:28:810-0600",
			lastUpdatedByID: "63581ba60012df9184a46ea1bfccb9cd",
			lastVersionNum: "2",
			objID: "6337489b00142d38d6c2579cbe2f6a6e",
			opTaskID: null,
			ownerID: "63581ba60012df9184a46ea1bfccb9cd",
			portfolioID: null,
			programID: null,
			projectID: "6337489b00142d29ea85721d1fde66ee",
			publicToken: null,
			referenceNumber: 13800,
			releaseVersionID: null,
			securityRootID: "6337489b00142d29ea85721d1fde66ee",
			securityRootObjCode: "PROJ",
			taskID: "6337489b00142d38d6c2579cbe2f6a6e",
			templateID: null,
			templateTaskID: null,
			topDocObjCode: "PROJ",
			topObjID: "6337489b00142d29ea85721d1fde66ee",
			userID: null,
			downloadURL: "/internal/document/download?ID=63bdb0a900075767602bb85c52fa5f1d",
			parameterValues: {
				"DE:Typeahead field": '{"objCode":"USER","name":"Lynton Web","ID":"63581ba60012df9184a46ea1bfccb9cd"}',
				"DE:Date field - display time": "2023-01-09T11:45:00:000-0600",
				"DE:Date field": "2023-01-09",
				"DE:Checkbox group field": ["select 1", "select 4"],
				"DE:Dropdown field": "select 2",
				"DE:Text field with formatting":
					'{"blocks":[{"key":"7lh78","text":"Text field with formatting","type":"unstyled","depth":0,"inlineStyleRanges":[{"offset":0,"length":4,"style":"BOLD"},{"offset":5,"length":5,"style":"ITALIC"},{"offset":11,"length":4,"style":"UNDERLINE"}],"entityRanges":[],"data":{}},{"key":"2ji6k","text":"item 1","type":"ordered-list-item","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"dkugk","text":"item 2","type":"ordered-list-item","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"dftlv","text":"bullet 1","type":"unordered-list-item","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"39mmv","text":"bullet 2","type":"unordered-list-item","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"a4rvf","text":"Quoted text","type":"blockquote","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}}],"entityMap":{}}',
				"DE:Paragraph text field": "paragraph\nnew line\ntesting",
				"DE:Single line text field": "single line test",
				"DE:Radio button group field": "select 3",
				"DE:Calculated field": 100,
			},
			versions: [
				{
					ID: "63bdb0a900075768424eae4dec0cf334",
					objCode: "DOCV",
					ext: "png",
					fileName: "1_63bdb0a900075767602bb85c52fa5f1d_Pasted-image-1-10-2023-0",
					externalIntegrationType: "ATTASK",
					version: "1",
					fileType: "file",
				},
				{
					ID: "63d9af20002d242dca7c2bc70d9e16c4",
					objCode: "DOCV",
					ext: "png",
					fileName: "2_63bdb0a900075767602bb85c52fa5f1d_version_bump",
					externalIntegrationType: "ATTASK",
					version: "2",
					fileType: "file",
				},
			],
			task: {
				ID: "6337489b00142d38d6c2579cbe2f6a6e",
				name: "Requirements Detailed Out",
				objCode: "TASK",
				URL: null,
				actualCompletionDate: "2023-01-31T18:20:42:308-0600",
				actualCost: 0,
				actualDuration: 0,
				actualDurationMinutes: 0,
				actualExpenseCost: 0,
				actualLaborCost: 0,
				actualRevenue: 0,
				actualStartDate: "2023-01-31T18:20:42:308-0600",
				actualWork: 0,
				actualWorkRequired: 0,
				approvalCompletionDate: null,
				approvalEstStartDate: null,
				approvalPlannedStartDate: null,
				approvalProcessID: null,
				approvalProjectedStartDate: null,
				approvalStartDate: null,
				assignedToID: null,
				auditTypes: [],
				backlogOrder: 0,
				billingAmount: 0,
				billingRecordID: null,
				canStart: true,
				categoryID: "5f2c0bc4001be2d2dce81afbbcf7e68e",
				color: null,
				commitDate: null,
				completionPendingDate: null,
				condition: null,
				constraintDate: null,
				convertedOpTaskEntryDate: null,
				convertedOpTaskName: null,
				convertedOpTaskOriginatorID: null,
				costAmount: 0,
				costType: "UHR",
				cpi: 1,
				csi: 1,
				currentApprovalStepID: null,
				customerID: "5807c55400789d2ba24b3cbac3674e09",
				description: null,
				duration: 2,
				durationMinutes: 960,
				durationType: "A",
				durationUnit: "D",
				eac: 8,
				enteredByID: "61e1a70f000cedae620ff5e2114158d4",
				entryDate: "2022-09-30T14:50:51:948-0500",
				estCompletionDate: "2023-01-31T18:20:42:308-0600",
				estStartDate: "2023-01-31T18:20:42:308-0600",
				extRefID: null,
				groupID: "5807c55c0078a14930bfdb01b44e37fa",
				handoffDate: null,
				hasCompletionConstraint: false,
				hasDocuments: true,
				hasExpenses: false,
				hasMessages: false,
				hasNotes: false,
				hasResolvables: false,
				hasStartConstraint: false,
				hasTimedNotifications: false,
				hoursPerPoint: 0,
				indent: 2,
				isAgile: false,
				isCritical: true,
				isDurationLocked: false,
				isLevelingExcluded: false,
				isReady: false,
				isStatusComplete: true,
				isWorkRequiredLocked: false,
				iterationID: null,
				kanbanBoardID: null,
				kanbanFlag: null,
				lastConditionNoteID: null,
				lastNoteID: null,
				lastUpdateDate: "2023-04-24T20:53:55:632-0500",
				lastUpdatedByID: "63581ba60012df9184a46ea1bfccb9cd",
				levelingStartDelay: 0,
				levelingStartDelayMinutes: 0,
				milestoneID: null,
				numberOfChildren: 0,
				numberOpenOpTasks: 0,
				originalDuration: 0,
				originalWorkRequired: 0,
				parentID: "6337489b00142d373bc3ea64d2c0f81e",
				parentLag: 0,
				parentLagType: "d",
				pendingCalculation: null,
				pendingUpdateMethods: [],
				percentComplete: 100,
				personal: false,
				plannedCompletionDate: "2022-10-03T17:00:00:000-0500",
				plannedCost: 0,
				plannedDuration: 2,
				plannedDurationMinutes: 960,
				plannedExpenseCost: 0,
				plannedLaborCost: 0,
				plannedRevenue: 0,
				plannedStartDate: "2022-09-30T09:00:00:000-0500",
				previousStatus: "XXU",
				priority: 0,
				progressStatus: "ON",
				projectID: "6337489b00142d29ea85721d1fde66ee",
				projectedCompletionDate: "2023-01-31T18:20:42:308-0600",
				projectedDurationMinutes: 0,
				projectedStartDate: "2023-01-31T18:20:42:308-0600",
				recurrenceNumber: null,
				recurrenceRuleID: null,
				referenceNumber: 13706,
				rejectionIssueID: null,
				remainingDurationMinutes: 0,
				resourceScope: "NONE",
				revenueType: "NOB",
				roleID: "5807c55c0078a15152e259903f95de9a",
				securityRootID: "6337489b00142d29ea85721d1fde66ee",
				securityRootObjCode: "PROJ",
				slackDate: "2023-02-01",
				spi: 1,
				status: "CPL",
				statusUpdate: null,
				submittedByID: null,
				taskConstraint: "ASAP",
				taskNumber: 3,
				teamID: null,
				templateTaskID: "5ef22a7500962fc02c3a6004d9629e7a",
				trackingMode: "USER",
				version: 0,
				wbs: "1.1.1",
				work: 8,
				workRequired: 480,
				parameterValues: {
					"DE:Task custom form field": "Testing custom field",
				},
				reservedTimeID: null,
				reservedTime: null,
			},
		},
	],
	old_last_update: "2023-01-01T13:24:04.889Z",
	wf_sub_domain: "christinekrantz.my",
	config: {
		workfront_paging_limit: 100,
		initial_last_update: "2023-01-01T13:24:04.889Z",
		bynder_brand_id: "B4831B25-7103-4F9C-AB9980A17D98F040",
		workfront_task_status: "CPL",
		bynder_meta_id_workfront_doc_url: "74F390E6-918E-4ACE-8C0CA00005540A97",
		bynder_meta_id_workfront_task_url: "37709CEC-EBAD-42EF-9D5C68ACDB264389",
		bynder_meta_id_workfront_version_id: "567F67F3-A1C1-47EE-A73FEAEC37D96979",
		bynder_meta_id_workfront_doc_id: "7433D302-246D-45C8-80C58841FF0BF8D0",
		meta_mappings: [
			{
				workfrontMetadata: "jsonString",
				bynderMetaproperty: "jsonString",
			},
		],
	},
};

const run = function (input, fileInput) {
	// function called to fix Workfront timestamps
	function fixWorkfontTimestamp(ts) {
		// if timestamp contains three ":" instead of two, replace the 3rd one with a "."
		if (ts && ts.match(/:/g).length == 3) {
			const index = ts.lastIndexOf(":");
			ts = `${ts.substring(0, index)}.${ts.substring(index + 1)}`;
		}

		return ts;
	}

	const config = input.config;
	let new_last_update = input.old_last_update;

	// no extra meta_mappings set, default to an empty array
	if (!config.meta_mappings) config.meta_mappings = [];

	const wf_to_bynder = [];
	// loop workfront documents
	_.forEach(input.workfront_documents, function (wf) {
		// last document in the loop will be the value returned to then save to the tray storage key ..._wf_task_last_update
		new_last_update = fixWorkfontTimestamp(wf.task.lastUpdateDate);

		// get document latest version
		const latest_version = wf.versions.pop();

		// if the version is not hosted on Workfront ("ATTASK") then skip it
		if (latest_version.externalIntegrationType == "ATTASK") {
			// data will hold info used to upload Workfront documents to Bynder assets
			const data = {};
			data["workfront_doc_id"] = wf.ID;
			data["workfront_version_id"] = latest_version.ID; // could change to currentVersionID

			data["bynder_name"] = wf.name;
			data["bynder_description"] = wf.description;

			const metaproperty = [];
			// loop custom meta mappings to format Workfront metadata into a format Bynder metaproperties will accept
			_.forEach(config.meta_mappings, function (m) {
				console.log(m);
				const w = JSON.parse(m.workfrontMetadata);
				const b = JSON.parse(m.bynderMetaproperty);

				let value = "";
				switch (w.objectType) {
					case "document_custom":
						if (wf.parameterValues.hasOwnProperty(`DE:${w.name}`)) {
							value = wf.parameterValues[`DE:${w.name}`];
						}
						break;
					case "document_standard":
						value = wf[w.name];
						break;
					case "task_custom":
						if (wf.task.parameterValues.hasOwnProperty(`DE:${w.name}`)) {
							value = wf.task.parameterValues[`DE:${w.name}`];
						}
						break;
					case "task_standard":
						value = wf.task[w.name];
						break;
				}

				// dateTime values need their format fixed so Bynder will accept them
				if (w.propertyType == "dateTime") value = fixWorkfontTimestamp(value);

				// starting with a switch to support if we need to parse other types differently
				switch (b.type) {
					case "multiselect":
						// isArray check used to make sure the value is an array from workfront and if not set the value into an array for bynder
						value = value ? (Array.isArray(value) ? value : [value]) : [];
						break;
					default:
						// isArray check used to convert workfront array value into a comma-delimited string for bynder
						value = value ? [Array.isArray(value) ? value.join(", ") : value] : [];
						break;
				}

				// skip mapping if the value array doesn't have anything
				if (value.length > 0) metaproperty.push({ id: b.id, options: value });
			});

			// following 4 metaproperties are required by the integration so if there are no other custom mappings these will always be set
			// underscores added to the ID so it will add to the Bynder metaproperty options and can be used in a filter later
			metaproperty.push({ id: config.bynder_meta_id_workfront_doc_id, options: [`_${wf.ID}_`] });
			// sending version id to a text field still since it is just a string match in the workflow later
			metaproperty.push({ id: config.bynder_meta_id_workfront_version_id, options: [`_${latest_version.ID}_`] });

			const base_url = `https://${input.wf_sub_domain}.workfront.com`;
			// {workfront base url}/document/{workfront doc id}/{workfront version id}/details
			metaproperty.push({ id: config.bynder_meta_id_workfront_doc_url, options: [`${base_url}/document/${wf.ID}/${latest_version.ID}/details`] });
			// {workfront base url}/task/{workfront task id}/overview
			metaproperty.push({ id: config.bynder_meta_id_workfront_task_url, options: [`${base_url}/task/${wf.task.ID}/overview`] });

			data["bynder_metaproperty"] = metaproperty;

			wf_to_bynder.push(data);
		}
	});

	return { wf_to_bynder, new_last_update };
};

console.log(run(input));
